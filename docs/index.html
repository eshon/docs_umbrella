<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link rel="stylesheet" href="//unpkg.com/docsify/lib/themes/vue.css">
</head>
<body>
  <div id="app"></div>
  <script src="//unpkg.com/docsify-edit-on-github/index.js"></script>

  <script>
    window.$docsify = {
      name: 'Docs Umbrella',
      repo: 'https://github.com/eshon/docs_umbrella',
      markdown: {
        gfm: true,
        tables: true,
        renderer: {
          paragraph: function(text) {
            // Custom renderer for Github Wiki images markup:
            // [[images/possum.jpg | alt=possum]]
            if (text.startsWith('[[') && text.endsWith(']]')) {

              // func to replace 'images' with '_images'
              var replace_imgdir = function replace_imgdir(_href) {
                  if (_href.indexOf('_images') === -1) {
                    return _href.replace('images', '_images');
                  }
              };
              // remove brackets and whitespace
              var src_str = text.substring(2, text.indexOf("]]"));
              src_str = src_str.replace(/\s/g,'');

              // start building src url with or without alt val
              var src_url, img_tag,
                alt_start = src_str.indexOf("|alt=");

              // parse alt tag if there is one
              if (alt_start > -1) {
                src_url = src_str.substring(0, alt_start);
                alt_text = src_str.substring(alt_start+5); // after '|alt='
                src_url = replace_imgdir(src_url);
                img_tag = '<img src="' + src_url + '"';
                img_tag += ' alt="' + alt_text + '"';
              } else {
                src_url = replace_imgdir(src_str);
                img_tag = '<img src="' + src_url + '"';
              }
              img_tag += this.options.xhtml ? '/>' : '>';
              return img_tag;

            } else {
              // normal paragraph rendering
              return '<p>' + text + '</p>';
            }
          },
          image: function(href, title, text) {
            // func to replace 'images' with '_images'
            var replace_imgdir = function replace_imgdir(_href) {
                if (_href.indexOf('_images') === -1) {
                  return _href.replace('images', '_images');
                }
            };
            href = replace_imgdir(href);
            console.log(href);
            var out = '<img src="' + href + '" alt="' + text + '"';
            if (title) {
              out += ' title="' + title + '"';
            }
            out += this.options.xhtml ? '/>' : '>';
            return out;
          }
        }
      },
      homepage: 'Home.md',
      loadSidebar: true,
      plugins: [
        EditOnGithubPlugin.create('https://github.com/eshon/docs_umbrella/edit/master/docs/', '', 'Edit on Github')
      ]
    }
  </script>
  <script src="//unpkg.com/docsify/lib/docsify.min.js"></script>
</body>
</html>
